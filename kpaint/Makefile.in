# $Id$
##
## Makefile for kpaint
##

kde_libraries = @kde_libraries@
qt_libraries = @qt_libraries@
top_builddir = ..
LIBTOOL = @LIBTOOL@
KDE_RPATH = @KDE_RPATH@
#
# Configuration
#
topdir	=	@topdir@
prefix 	= 	@prefix@
INCDIRS	=	@all_includes@ -I.. -I../kview
LIBDIR	=	@all_libraries@ -L$(topdir)/kpaint/tools
topdir  =       @topdir@
MOC	=	@MOC@
CXX	= 	@CXX@
DEFS	=	-DHAVE_CONFIG_H
LDLIBS	=	-lkdeui -lkfm -lkdecore -lgif -lqt -lXext -lm -lX11 @LIBSOCKET@ @LIBJPEG@
METADIR	=	metas

INSTALL_DIR = @INSTALL@ -d -m 755 
INSTALL_DATA= @INSTALL@ -m 644
INSTALL_BIN = @INSTALL@ -m 755

#
# End Configuration
#

CXXFLAGS=	@CXXFLAGS@ $(DEFS) $(INCDIRS)
LDFLAGS=	@LDFLAGS@ $(LIBDIR)

OBJS=	main.o \
	app.o \
	canvas.o \
	kpaint.o \
	manager.o \
	formats.o \
	infodialog.o \
	depthdialog.o \
	palette.o \
	palettedialog.o \
	formatdialog.o \
	canvassize.o \
	properties.o \
	gif.o \
	jpeg.o \
	QwViewport.o \
	tool.o \
	ellipse.o \
	circle.o \
	line.o \
	spraycan.o \
	rectangle.o \
	pen.o \
	areaselect.o

METAS=	canvas.moc \
	app.moc \
	kpaint.moc \
	manager.moc \
	infodialog.moc \
	depthdialog.moc \
	properties.moc \
	formatdialog.moc \
	palette.moc \
	palettedialog.moc \
	QwViewport.moc \
	tool.moc \
	spraycan.moc

.PHONY:	all clean install uninstall

#
# Implicit rules
#

%.o:	%.cpp
	$(CXX) -c $(CXXFLAGS) -o $@ $<

%.moc:	%.h
	$(MOC) -o $@ $<

all:	kpaint

install: all
	$(INSTALL_DIR) $(prefix)/bin
	$(INSTALL_BIN) kpaint $(prefix)/bin
	$(INSTALL_DIR) $(prefix)/share/icons
	(cd doc ; $(MAKE) install)
	(cd toolpics ; $(MAKE) install)
	$(INSTALL_DIR) $(prefix)/share/applnk/Graphics
	$(INSTALL_DATA) Paint.kdelnk $(prefix)/share/applnk/Graphics 
	$(INSTALL_DATA) kpaint.xpm $(prefix)/share/icons
	$(INSTALL_DATA) mini-kpaint.xpm $(prefix)/share/icons/mini/kpaint.xpm

uninstall:
	-rm -f $(prefix)/bin/kpaint
	-rm -rf $(prefix)/share/doc/HTML/kpaint
	-rm -f $(prefix)/share/applnk/Graphics/Paint.kdelnk
	-rm -f $(prefix)/share/icons/kpaint.xpm
	-rm -f $(prefix)/share/icons/mini/kpaint.xpm

Makefile:	Makefile.in
	cd .. && CONFIG_FILES=kpaint/$@ CONFIG_HEADERS= $(SHELL) ./config.status

kpaint: $(METAS) $(OBJS)
	$(LIBTOOL) --mode=link $(CXX) $(LDFLAGS) -o $@ $(OBJS) $(LDLIBS) $(KDE_RPATH)

clean:
	-rm -f $(OBJS) *.moc kpaint

realclean:  clean
	-rm -f kpaint

messages:
	@XGETTEXT@ -C --keyword=translate -x ../../kdelibs/po/kde.pot *.cpp && mv messages.po ../po/kpaint.pot

