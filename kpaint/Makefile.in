# $Id$
##
## Makefile for kpaint
##

#
# Configuration
#
prefix 	= 	@prefix@
topdir	= 	@topdir@
INCDIRS	=	@all_includes@ -I.. -I../kview
LIBDIR	=	@all_libraries@ -Ltools
MOC	=	@MOC@
CXX	= 	@CXX@
DEFS	=	-DHAVE_CONFIG_H
LDLIBS	=	-lkptools -lkdeui -lkdecore -lgif -lqt -lXext -lm -lX11 @LIBJPEG@

INSTALL_DIR = @INSTALL@ -d -m 755 
INSTALL_DATA= @INSTALL@ -m 644
INSTALL_BIN = @INSTALL@ -m 755

#
# End Configuration
#

CXXFLAGS=	@CXXFLAGS@ $(DEFS) $(INCDIRS)
LDFLAGS=	@LDFLAGS@ $(LIBDIR)

OBJS=	main.o \
	app.o \
	canvas.o \
	kpaint.o \
	manager.o \
	formats.o \
	infodialog.o \
	palette.o \
	palettedialog.o \
	canvassize.o \
	properties.o \
	gif.o \
	jpeg.o \
	QwViewport.o

METAS=	canvas.moc \
	app.moc \
	kpaint.moc \
	manager.moc \
	infodialog.moc \
	properties.moc \
	palette.moc \
	palettedialog.moc \
	QwViewport.moc

.PHONY:	all clean kplib install uninstall

#
# Implicit rules
#

%.o:	%.cpp
	$(CXX) -c $(CXXFLAGS) -o $@ $<

%.moc:	%.h
	$(MOC) -o $@ $<

all:	kplib kpaint

Makefile: Makefile.in
	cd .. && CONFIG_FILES=kpaint/$@ CONFIG_HEADERS= $(SHELL) ./config.status

install: all
	$(INSTALL_DIR) $(prefix)/bin
	$(INSTALL_DIR) $(prefix)/doc/HTML/kpaint
	$(INSTALL_BIN) kpaint $(prefix)/bin
	$(INSTALL_DATA) doc/HTML/kpaint.html $(prefix)/doc/HTML/kpaint
	$(INSTALL_DIR) $(prefix)/apps/Applications
	$(INSTALL_DATA) Paint.kdelnk $(prefix)/apps/Applications 
	(cd toolpics && $(MAKE) install)

uninstall:
	rm -f $(prefix)/bin/kpaint
	rm -rf $(prefix)/doc/HTML/kpaint
	rm -f $(prefix)/apps/Applications/Paint.kdelnk
	(cd toolpics && $(MAKE) uninstall)
	
kplib:
	(cd tools; $(MAKE) all)

kpaint: $(METAS) $(OBJS)
	$(CXX) $(LDFLAGS) -o $@ $(OBJS) $(LDLIBS)

clean:
	$(MAKE) -C tools clean
	-rm -f $(OBJS) *.moc kpaint tools/libkptools.a

realclean:  clean
	$(MAKE) -C tools realclean
	-rm -f kpaint



