# $Id$

kde_libraries = @kde_libraries@
qt_libraries = @qt_libraries@
top_builddir = ..
LIBTOOL = @LIBTOOL@
KDE_RPATH = @KDE_RPATH@

prefix  = @prefix@
BINDIR  = $(prefix)/bin
LIBDIR  = $(prefix)/lib
TOOLDIR  = $(prefix)/share/toolbar
MIMEDIR = $(prefix)/share/mimelnk/image/
DOCSDIR = $(prefix)/share/doc/default/HTML/en/kfax
APPSDIR = $(prefix)/applnk/Graphics
PICSDIR = $(prefix)/share/apps/kfax/pics/
install = @INSTALL@
INSTALL = $(install) -m 0755
INSTALL_DATA = $(install) -m 0644
INSTALL_DIR = $(install) -d -m 0755   

###################################################################

CXXFLAGS=	@CXXFLAGS@  -DHAVE_CONFIG_H -I..
CFLAGS=		@CFLAGS@  -DHAVE_CONFIG_H -I..

LDFLAGS	=	@LDFLAGS@ @all_libraries@ -lkfm -lkdecore -lkdeui -lqt -lm -lXext -lX11 ./libtiffax/libtif.a
INCDIR	=	@all_includes@ -I./libtiffax
CXX	=	@CXX@
CC      =	@CC@
MOC	=	@MOC@


####### Files
HEADER = 	kfax.h faxexpand.h print.h options.h about.h


SOURCES	=	kfax.cpp viewfax.cpp faxexpand.cpp faxinit.cpp faxinput.cpp\
		 fax2tiff.c fax2ps.c print.cpp options.cpp about.cpp


OBJECTS	=	kfax.o viewfax.o faxexpand.o faxinit.o faxinput.o fax2tiff.o\
		 fax2ps.o print.o options.o about.o


SRCMETA	=	kfax.moc print.moc options.moc about.moc


TARGET	=	kfax

####### Implicit rules

.SUFFIXES: .cpp

.cpp.o:
	$(CXX)  -c $(CXXFLAGS) $(DEFS) $(INCDIR) $(HELP) $<
.c.o:
	$(CXX)  -c $(CXXFLAGS) $(DEFS) $(INCDIR) $(HELP) $<

####### Build rules

all: libtiff $(TARGET)

Makefile: Makefile.in
	cd .. && CONFIG_FILES=kfax/$@ CONFIG_HEADERS= $(SHELL) ./config.status

$(TARGET): $(SOURCES) $(SRCMETA) $(OBJECTS) $(HEADER)
	$(LIBTOOL) --mode=link $(CXX) $(OBJECTS) -o $(TARGET) $(LDFLAGS) $(KDE_RPATH)

libtiff:
	(cd libtiffax && $(MAKE) all)

depend:
	@makedepend -I$(INCDIR) $(SOURCES) 2> /dev/null
clean:
	(cd libtiffax && $(MAKE) clean)
	-rm -f *.o *.bak *~ *% #*
	-rm -f $(SRCMETA) $(TARGET)

distclean: clean
	rm -f Makefile

install: all
	$(INSTALL_DIR) $(BINDIR)
	$(INSTALL) $(TARGET) $(BINDIR)
	(cd docs && $(MAKE) install)
	$(INSTALL_DIR) $(TOOLDIR)
	$(INSTALL_DATA) zoomin.xpm $(TOOLDIR)
	$(INSTALL_DIR) $(PICSDIR)
	$(INSTALL_DATA)  kfax.tif $(PICSDIR)
	$(INSTALL_DATA)  kfaxlogo.xpm $(PICSDIR)
	$(INSTALL_DATA) zoomout.xpm $(TOOLDIR)
	$(INSTALL_DIR) $(MIMEDIR)	
	$(INSTALL_DIR) $(APPSDIR)
	$(INSTALL_DATA) fax-g3.kdelnk $(MIMEDIR)
	$(INSTALL_DATA) KFax.kdelnk $(APPSDIR)/KFax.kdelnk

uninstall:
	rm -f $(BINDIR)/$(TARGET)
	(cd docs && $(MAKE) uninstall)
	rm -f $(APPSDIR)/KFax.kdelnk

####### Explicit dependencies


####### Meta objects

kfax.moc: kfax.h
	$(MOC) kfax.h -o kfax.moc

about.moc: about.h
	$(MOC) about.h -o about.moc

print.moc: print.h
	$(MOC) print.h -o print.moc

options.moc: options.h
	$(MOC) options.h -o options.moc

fax2ps.o: fax2ps.c
	$(CC) $(CFALGS) -c $(DEFS) $(INCDIR)  fax2ps.c

fax2tiff.o: fax2tiff.c
	$(CC) $(CFALGS) -c $(DEFS) $(INCDIR)  fax2tiff.c







