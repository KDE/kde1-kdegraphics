# $Id$

prefix  = @prefix@
BINDIR  = $(prefix)/bin
LIBDIR  = $(prefix)/lib
PIXDIR  = $(prefix)/lib/pics/toolbar
DOCSDIR = $(prefix)/doc/HTML/kfax
APPSDIR = $(prefix)/apps/Graphics
HELPF = $(prefix)/doc/HTML/kfax/kfax.tif
HELP = -DHELPFILE=\"$(HELPF)\"
install = @INSTALL@
INSTALL = $(install) -m 0755
INSTALL_DATA = $(install) -m 0644
INSTALL_DIR = $(install) -d -m 0755   

###################################################################

CXXFLAGS=	@CXXFLAGS@  -DHAVE_CONFIG_H -I..
CFLAGS=		@CFLAGS@  -DHAVE_CONFIG_H -I..

LDFLAGS	=	@LDFLAGS@ @all_libraries@ -lkfm -lkdecore -lkdeui -lqt -lm -lXext -lX11 ./libtiffax/libtiffax.a
INCDIR	=	@all_includes@ -I./libtiffax
CXX	=	@CXX@
CC      =	@CC@
MOC	=	@MOC@


####### Files
HEADER = 	kfax.h faxexpand.h 


SOURCES	=	kfax.cpp viewfax.cpp faxexpand.cpp faxinit.cpp faxinput.cpp fax2tiff.c fax2ps.c print.cpp options.cpp


OBJECTS	=	kfax.o viewfax.o faxexpand.o faxinit.o faxinput.o fax2tiff.o fax2ps.o print.o options.o


SRCMETA	=	kfax.moc print.moc options.moc


TARGET	=	kfax

####### Implicit rules

.SUFFIXES: .cpp

.cpp.o:
	$(CXX)  -c $(CXXFLAGS) $(DEFS) $(INCDIR) $(HELP) $<
.c.o:
	$(CXX)  -c $(CXXFLAGS) $(DEFS) $(INCDIR) $(HELP) $<

####### Build rules

all: libtiff $(TARGET)

Makefile: Makefile.in
	cd .. && CONFIG_FILES=kfax/$@ CONFIG_HEADERS= $(SHELL) ./config.status

$(TARGET): $(SOURCES) $(SRCMETA) $(OBJECTS) $(HEADER)
	$(CXX) $(OBJECTS) -o $(TARGET) $(LDFLAGS)

libtiff:
	(cd libtiffax && $(MAKE) all)

depend:
	@makedepend -I$(INCDIR) $(SOURCES) 2> /dev/null
clean:
	(cd libtiffax && $(MAKE) clean)
	-rm -f *.o *.bak *~ *% #*
	-rm -f $(SRCMETA) $(TARGET)

distclean: clean
	rm -f Makefile

install: all
	$(INSTALL_DIR) $(BINDIR)
	$(INSTALL) $(TARGET) $(BINDIR)
	(cd docs && $(MAKE) install)
	$(INSTALL_DIR) $(PIXDIR)
	$(INSTALL_DATA) zoomin.xpm $(PIXDIR)
	$(INSTALL_DATA) zoomout.xpm $(PIXDIR)
	$(INSTALL_DIR) $(APPSDIR)
	$(INSTALL_DATA) KFax.kdelnk $(APPSDIR)/KFax.kdelnk

uninstall:
	rm -f $(BINDIR)/$(TARGET)
	(cd docs && $(MAKE) uninstall)
	rm -f $(APPSDIR)/KFax.kdelnk
	rm -f $(PIXDIR)/zoomin.xpm
	rm -f $(PIXDIR)/zoomout.xpm

####### Explicit dependencies


####### Meta objects

kfax.moc: kfax.h
	$(MOC) kfax.h -o kfax.moc

print.moc: print.h
	$(MOC) print.h -o print.moc

options.moc: options.h
	$(MOC) options.h -o options.moc

fax2ps.o: fax2ps.c
	$(CC) $(CFALGS) -c $(DEFS) $(INCDIR)  fax2ps.c

fax2tiff.o: fax2tiff.c
	$(CC) $(CFALGS) -c $(DEFS) $(INCDIR)  fax2tiff.c







